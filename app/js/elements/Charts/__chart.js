import React, {Components} from 'react';
import Highcharts from 'highcharts/highstock'
import HighchartsReact from 'highcharts-react-official'
import Stellar from 'stellar-sdk';
import AssetSlug from '../../helpers/DataServer/Assets/Assets';
import Orderbook from '../../helpers/DataServer/OrderBook';



//TODO initial driver prototype for orderBook
const SERVER_URL = 'https://horizon.stellar.org';
let STLKey = 'GPublic Global Stellar Network ; September 2015';
let ServerNew = new Stellar.Server(SERVER_URL);
let urlParts1 = 'SLT-smartlands.io';
let urlParts2 = 'XLM-native';
ServerNew.serverUrl = SERVER_URL;

let network = {
    horizonUrl: 'https://horizon.stellar.org',
    networkPassphrase: STLKey,
    isDefault: true,
    isTestnet: false,
    isCustom: false,
};

Stellar.Network.use(new Stellar.Network(network.networkPassphrase));



function Driver(driverOpts) {
    this.Server = new Stellar.Server(driverOpts.network.horizonUrl);
    this.Server.serverUrl = driverOpts.network.horizonUrl;
    this.orderbook = new Orderbook(this);
}


let driver = new Driver({
    network,
});

let baseBuying = AssetSlug.parseAssetSlug(urlParts1);
let counterSelling = AssetSlug.parseAssetSlug(urlParts2);
driver.orderbook.handlers.setOrderbook(baseBuying, counterSelling);

let DataNew = [];
setTimeout(()=>{
    let dataForChart = driver.orderbook.data;
    let dataForChart2 = dataForChart.trades;
    DataNew.push(...dataForChart2);
},5000);


console.log("DataNew", driver.orderbook);

// const testData = [
//
//
//     [1522688400000, 3.95],
//
//     [1522689300000, 3.700011],
//
//     [1522692000000, 3.95],
//
//     [1522692900000, 3.97],
//
//     [1522693800000, 3.97],
//
//     [1522694700000, 3.998],
//
//     [1522695600000, 3.8500309],
//
//     [1522696500000, 3.9988],
//
//     [1522697400000, 3.998],
//
//     [1522698300000, 3.9988],
//
//     [1522699200000, 3.9988],
//
//     [1522700100000, 4.0101],
//
//     [1522701000000, 4.16501],
//
//     [1522701900000, 4.39],
//
//     [1522702800000, 4.39],
//
//     [1522703700000, 4.4],
//
//     [1522704600000, 4.35001],
//
//     [1522706400000, 4.53],
//
//     [1522707300000, 4.75],
//
//     [1522708200000, 4.74997],
//
//     [1522709100000, 4.74989],
//
//     [1522710000000, 4.75],
//
//     [1522710900000, 4.74],
//
//     [1522712700000, 4.73989],
//
//     [1522714500000, 4.3],
//
//     [1522715400000, 4.73799],
//
//     [1522716300000, 4.73699],
//
//     [1522717200000, 3.9988],
//
//     [1522721700000, 4.734992],
//
//     [1522723500000, 4.0150229],
//
//     [1522724400000, 4.59969],
//
//     [1522725300000, 4.095],
//
//     [1522726200000, 4.0555],
//
//     [1522727100000, 4.0555],
//
//     [1522728900000, 4.0955],
//
//     [1522732500000, 4.06001],
//
//     [1522733400000, 4.0562],
//
//     [1522736100000, 4.056],
//
//     [1522744200000, 4.2],
//
//     [1522746900000, 4.2],
//
//     [1522748700000, 4.4484916],
//
//     [1522752300000, 4.4468912],
//
//     [1522753200000, 4.44579],
//
//     [1522758600000, 4.41],
//
//     [1522759500000, 4.42],
//
//     [1522761300000, 4.42],
//
//     [1522762200000, 4.1100101],
//
//     [1522764000000, 4.1100101],
//
//     [1522767600000, 4.3999999],
//
//     [1522768500000, 4.34001],
//
//     [1522769400000, 4.1],
//
//     [1522771200000, 4.3499803],
//
//     [1522772100000, 4.09],
//
//     [1522773000000, 4.0005],
//
//     [1522780200000, 4.0005],
//
//     [1522782000000, 4.27488],
//
//     [1522783800000, 4.0005],
//
//     [1522784700000, 4.27487],
//
//     [1522786500000, 3.99],
//
//     [1522788300000, 3.753],
//
//     [1522789200000, 3.9999399],
//
//     [1522790100000, 3.7230013],
//
//     [1522791900000, 3.97],
//
//     [1522792800000, 3.73003],
//
//     [1522796400000, 3.73006],
//
//     [1522797300000, 3.999969],
//
//     [1522798200000, 3.999979],
//
//     [1522805400000, 3.999979],
//
//     [1522807200000, 3.999979],
//
//     [1522808100000, 3.73008],
//
//     [1522810800000, 3.73006],
//
//     [1522818000000, 3.79999],
//
//     [1522824300000, 3.98],
//
//     [1522829700000, 3.73005],
//
//     [1522830600000, 3.75],
//
//     [1522831500000, 3.75],
//
//     [1522832400000, 3.73003],
//
//     [1522836900000, 3.75],
//
//     [1522841400000, 3.94996],
//
//     [1522844100000, 3.75],
//
//     [1522851300000, 3.76],
//
//     [1522852200000, 3.9],
//
//     [1522853100000, 3.949],
//
//     [1522854900000, 3.86],
//
//     [1522861200000, 3.98],
//
//     [1522862100000, 3.98],
//
//     [1522863000000, 4],
//
//     [1522863900000, 4],
//
//     [1522864800000, 4],
//
//     [1522866600000, 4],
//
//     [1522867500000, 4],
//
//     [1522872000000, 4.3],
//
//     [1522872900000, 5.15],
//
//     [1522873800000, 4.8],
//
//     [1522874700000, 5.2],
//
//     [1522875600000, 4.75],
//
//     [1522876500000, 4.75],
//
//     [1522877400000, 5.14001],
//
//     [1522878300000, 4.70001],
//
//     [1522880100000, 5.13999],
//
//     [1522881000000, 5.08001],
//
//     [1522882800000, 5.08001],
//
//     [1522883700000, 4.25],
//
//     [1522890000000, 4.2500009],
//
//     [1522890900000, 4.25],
//
//     [1522895400000, 4.49999],
//
//     [1522896300000, 4.2199],
//
//     [1522897200000, 4.49969],
//
//     [1522903500000, 4.5],
//
//     [1522908900000, 4.199],
//
//     [1522913400000, 4.150001],
//
//     [1522917000000, 4.45799],
//
//     [1522917900000, 4.7],
//
//     [1522922400000, 4.7],
//
//     [1522926900000, 4.7],
//
//     [1522927800000, 4.69999],
//
//     [1522930500000, 4.1500012],
//
//     [1522932300000, 4.69],
//
//     [1522934100000, 4.5],
//
//     [1522935000000, 4.6],
//
//     [1522937700000, 4.19],
//
//     [1522938600000, 4.11],
//
//     [1522939500000, 4.17989],
//
//     [1522944900000, 4.4],
//
//     [1522951200000, 4.16001],
//
//     [1522957500000, 4.16002],
//
//     [1522958400000, 4.16001],
//
//     [1522960200000, 4.4211002],
//
//     [1522961100000, 4.4211003],
//
//     [1522962900000, 4.5],
//
//     [1522966500000, 4.64899],
//
//     [1522969200000, 4.42301],
//
//     [1522970100000, 4.4000001],
//
//     [1522971000000, 4.512],
//
//     [1522983600000, 4.25005],
//
//     [1522989900000, 5.23],
//
//     [1522991700000, 5.2399993],
//
//     [1522994400000, 4.85001],
//
//     [1522998000000, 4.69999],
//
//     [1522998900000, 4.69999],
//
//     [1523006100000, 4.9],
//
//     [1523010600000, 5],
//
//     [1523011500000, 5],
//
//     [1523015100000, 4.99],
//
//     [1523016000000, 4.88001],
//
//     [1523016900000, 4.6000001],
//
//     [1523019600000, 4.97999],
//
//     [1523022300000, 4.50302],
//
//     [1523023200000, 4.98799],
//
//     [1523024100000, 4.98889],
//
//     [1523025000000, 4.93001],
//
//     [1523025900000, 4.93001],
//
//     [1523026800000, 4.51],
//
//     [1523034000000, 4.520005],
//
//     [1523036700000, 4.62999],
//
//     [1523045700000, 4.62999],
//
//     [1523052000000, 4.63],
//
//     [1523056500000, 4.510014],
//
//     [1523074500000, 4.63],
//
//     [1523080800000, 4.510003],
//
//     [1523081700000, 4.4110001],
//
//     [1523087100000, 4.40001],
//
//     [1523091600000, 4.62999],
//
//     [1523093400000, 4.63],
//
//     [1523094300000, 4.63],
//
//     [1523095200000, 4.63],
//
//     [1523097000000, 4.63],
//
//     [1523104200000, 4.7],
//
//     [1523105100000, 4.6492706],
//
//     [1523106000000, 4.69999],
//
//     [1523107800000, 4.69999],
//
//     [1523108700000, 4.42],
//
//     [1523109600000, 4.92999],
//
//     [1523110500000, 4.92999],
//
//     [1523111400000, 4.4500102],
//
//     [1523112300000, 4.49999],
//
//     [1523113200000, 4.5000257],
//
//     [1523114100000, 4.500037],
//
//     [1523115900000, 4.99999],
//
//     [1523116800000, 4.8],
//
//     [1523118600000, 4.5002],
//
//     [1523120400000, 4.8499645],
//
//     [1523123100000, 4.5002],
//
//     [1523133900000, 4.5002],
//
//     [1523135700000, 4.8499645],
//
//     [1523138400000, 4.5002001],
//
//     [1523147400000, 4.84995],
//
//     [1523148300000, 4.84995],
//
//     [1523156400000, 4.62],
//
//     [1523167200000, 4.5551101],
//
//     [1523171700000, 4.5551101],
//
//     [1523181600000, 4.55601],
//
//     [1523192400000, 4.7619048],
//
//     [1523193300000, 4.83],
//
//     [1523194200000, 4.83],
//
//     [1523196900000, 4.7619048],
//
//     [1523201400000, 4.83],
//
//     [1523203200000, 4.8299],
//
//     [1523207700000, 4.601],
//
//     [1523208600000, 4.601],
//
//     [1523210400000, 4.6470201],
//
//     [1523213100000, 4.6470201],
//
//     [1523215800000, 4.6470201],
//
//     [1523220300000, 4.6470201],
//
//     [1523222100000, 4.82899],
//
//     [1523227500000, 4.60101],
//
//     [1523232000000, 4.6470302],
//
//     [1523236500000, 4.6470302],
//
//     [1523237400000, 4.6470302],
//
//     [1523243700000, 4.6470302],
//
//     [1523253600000, 4.828],
//
//     [1523254500000, 4.601],
//
//     [1523255400000, 4.6652017],
//
//     [1523260800000, 4.60101],
//
//     [1523261700000, 4.60101],
//
//     [1523271600000, 4.6652017],
//
//     [1523273400000, 4.602],
//
//     [1523275200000, 4.55],
//
//     [1523277900000, 4.6652017],
//
//     [1523285100000, 4.6652017],
//
//     [1523286000000, 4.6460101],
//
//     [1523286900000, 4.6460101],
//
//     [1523289600000, 4.60001],
//
//     [1523290500000, 4.60001],
//
//     [1523291400000, 4.8268],
//
//     [1523294100000, 4.6460101],
//
//     [1523295000000, 4.6965101],
//
//     [1523297700000, 4.8268],
//
//     [1523300400000, 4.8268],
//
//     [1523301300000, 4.6],
//
//     [1523302200000, 4.6662203],
//
//     [1523310300000, 4.7],
//
//     [1523315700000, 4.7],
//
//     [1523316600000, 4.7],
//
//     [1523317500000, 4.82],
//
//     [1523322000000, 4.7000189],
//
//     [1523326500000, 4.5571204],
//
//     [1523336400000, 4.62001],
//
//     [1523337300000, 4.62001],
//
//     [1523338200000, 4.62001],
//
//     [1523339100000, 4.78999],
//
//     [1523350800000, 4.78899],
//
//     [1523359800000, 4.681],
//
//     [1523361600000, 4.68999],
//
//     [1523362500000, 4.62],
//
//     [1523365200000, 4.62],
//
//     [1523366100000, 4.68999],
//
//     [1523370600000, 4.739],
//
//     [1523372400000, 4.57001],
//
//     [1523375100000, 4.739],
//
//     [1523376000000, 4.70001],
//
//     [1523378700000, 4.72],
//
//     [1523383200000, 4.7],
//
//     [1523384100000, 4.79999],
//
//     [1523390400000, 4.79989],
//
//     [1523401200000, 4.76999],
//
//     [1523407500000, 4.71],
//
//     [1523411100000, 4.77],
//
//     [1523412000000, 4.7999],
//
//     [1523412900000, 4.77],
//
//     [1523421900000, 4.6],
//
//     [1523422800000, 4.55],
//
//     [1523425500000, 4.55],
//
//     [1523426400000, 4.55],
//
//     [1523430900000, 4.55],
//
//     [1523434500000, 4.79989],
//
//     [1523448000000, 4.5500004],
//
//     [1523449800000, 4.67],
//
//     [1523450700000, 4.67],
//
//     [1523452500000, 4.5600009],
//
//     [1523453400000, 4.79989],
//
//     [1523456100000, 4.5700221],
//
//     [1523458800000, 4.5800321],
//
//     [1523459700000, 4.6000001],
//
//     [1523460600000, 4.5800221],
//
//     [1523462400000, 4.74989],
//
//     [1523469600000, 4.581],
//
//     [1523477700000, 4.689991],
//
//     [1523478600000, 4.72499],
//
//     [1523479500000, 4.72499],
//
//     [1523480400000, 4.725],
//
//     [1523483100000, 4.725],
//
//     [1523499300000, 4.75],
//
//     [1523507400000, 4.6000101],
//
//     [1523511900000, 4.71001],
//
//     [1523520000000, 4.71001],
//
//     [1523524500000, 4.71],
//
//     [1523533500000, 4.62002],
//
//     [1523534400000, 4.62002],
//
//     [1523538900000, 4.75],
//
//     [1523551500000, 4.74492],
//
//     [1523553300000, 4.74492],
//
//     [1523554200000, 4.62003],
//
//     [1523556900000, 4.58101],
//
//     [1523560500000, 4.58101],
//
//     [1523565900000, 4.51],
//
//     [1523568600000, 4.74199],
//
//     [1523571300000, 4.74198],
//
//     [1523573100000, 4.7399],
//
//     [1523574000000, 4.7399],
//
//     [1523576700000, 4.62003],
//
//     [1523581200000, 4.59999],
//
//     [1523585700000, 4.50992],
//
//     [1523586600000, 4.71999],
//
//     [1523588400000, 4.39999],
//
//     [1523589300000, 4.745],
//
//     [1523599200000, 4.7449999],
//
//     [1523602800000, 4.744],
//
//     [1523608200000, 4.33],
//
//     [1523609100000, 4.32],
//
//     [1523612700000, 4.49999],
//
//     [1523613600000, 4.45],
//
//     [1523614500000, 4.3100011],
//
//     [1523615400000, 4.311],
//
//     [1523619000000, 4.32],
//
//     [1523620800000, 4.2200004],
//
//     [1523621700000, 4.212],
//
//     [1523622600000, 4.212],
//
//     [1523624400000, 4.37999],
//
//     [1523625300000, 4.38],
//
//     [1523626200000, 4.201999],
//
//     [1523627100000, 4.18999],
//
//     [1523630700000, 4.18999],
//
//     [1523631600000, 4.11001],
//
//     [1523632500000, 4.1],
//
//     [1523633400000, 4.0200005],
//
//     [1523634300000, 4],
//
//     [1523635200000, 4.3799],
//
//     [1523636100000, 4.201],
//
//     [1523637000000, 4.38],
//
//     [1523637900000, 4.379],
//
//     [1523641500000, 4.38],
//
//     [1523659500000, 4.38],
//
//     [1523660400000, 4.38],
//
//     [1523664000000, 4.20012],
//
//     [1523673900000, 4.38],
//
//     [1523674800000, 4.42999],
//
//     [1523675700000, 4.20012],
//
//     [1523679300000, 4.20012],
//
//     [1523689200000, 3.9],
//
//     [1523696400000, 4.15],
//
//     [1523699100000, 3.9],
//
//     [1523700000000, 4.3999502],
//
//     [1523702700000, 4.4],
//
//     [1523703600000, 4.3998],
//
//     [1523709000000, 4.00001],
//
//     [1523709900000, 3.9500701],
//
//     [1523710800000, 4.34988],
//
//     [1523711700000, 4.39983],
//
//     [1523719800000, 4.38],
//
//     [1523720700000, 4.38],
//
//     [1523741400000, 4.3499],
//
//     [1523743200000, 4.3499],
//
//     [1523758500000, 3.9000915],
//
//     [1523759400000, 3.9000901],
//
//     [1523760300000, 3.8000144],
//
//     [1523762100000, 3.8000144],
//
//     [1523764800000, 3.8500044],
//
//     [1523765700000, 4.17501],
//
//     [1523767500000, 3.8000144],
//
//     [1523770200000, 4.0999999],
//
//     [1523772900000, 3.91001],
//
//     [1523781000000, 4.0999999],
//
//     [1523781900000, 4.0999999],
//
//     [1523788200000, 4.04],
//
//     [1523793600000, 3.77],
//
//     [1523794500000, 3.7600106],
//
//     [1523796300000, 3.7600106],
//
//     [1523798100000, 3.7600106],
//
//     [1523799900000, 3.876],
//
//     [1523800800000, 3.876],
//
//     [1523801700000, 3.876],
//
//     [1523802600000, 3.76],
//
//     [1523803500000, 3.76],
//
//     [1523805300000, 3.75],
//
//     [1523806200000, 3.87599],
//
//     [1523807100000, 3.71601],
//
//     [1523815200000, 3.87597],
//
//     [1523822400000, 3.87597],
//
//     [1523824200000, 3.87599],
//
//     [1523826900000, 3.87599],
//
//     [1523827800000, 3.876],
//
//     [1523828700000, 3.73201],
//
//     [1523834100000, 3.876],
//
//     [1523835900000, 3.979],
//
//     [1523837700000, 3.99999],
//
//     [1523842200000, 4.04],
//
//     [1523846700000, 3.979],
//
//     [1523858400000, 4.04],
//
//     [1523859300000, 4.06],
//
//     [1523863800000, 3.73001],
//
//     [1523866500000, 3.73001],
//
//     [1523870100000, 4.03998],
//
//     [1523872800000, 3.7160101],
//
//     [1523878200000, 3.7160101],
//
//     [1523884500000, 4.019966],
//
//     [1523885400000, 3.715],
//
//     [1523888100000, 3.969986],
//
// ];

// Highstock configuration
const minuteFullDateFormat = '%Y-%m-%d %H:%M';
const minutePartDateFormat = '%m-%d %H:%M';
const dayPartDateFormat = '%m-%d';
const dayFullDateFormat = '%Y-%m-%d';
const monthFullDateFormat = '%Y-%m';
// Display time in UK format: 17 January 2017 15:37

const axisDTLF = {
    millisecond: minutePartDateFormat,
    second: minutePartDateFormat,
    minute: minutePartDateFormat,
    hour: minutePartDateFormat,
    day: minutePartDateFormat,
    week: minuteFullDateFormat,
    month: dayFullDateFormat,
    year: dayFullDateFormat,
};

const dateTimeLabelFormats = {
    millisecond: minuteFullDateFormat,
    second: minuteFullDateFormat,
    minute: minuteFullDateFormat,
    hour: minuteFullDateFormat,
    day: minuteFullDateFormat,
    week: minuteFullDateFormat,
    month: monthFullDateFormat,
    year: '%Y',
};

const dataGroupingDateTimeLabelFormats = {
    millisecond: [minuteFullDateFormat, minuteFullDateFormat, ''],
    second: [minuteFullDateFormat, minuteFullDateFormat, ''],
    minute: [minuteFullDateFormat, minuteFullDateFormat, ''],
    hour: [minuteFullDateFormat, minuteFullDateFormat, ''],
    day: [minuteFullDateFormat, minuteFullDateFormat, ''],
    week: [minuteFullDateFormat, minuteFullDateFormat, ''],
    month: [monthFullDateFormat, monthFullDateFormat, ''],
    year: ['%Y', '%Y', '-%Y'],
};

// const height = elem.clientHeight;
// const width = elem.clientWidth;

const pairName = 'STL/XML';
// window.elem = elem;

const highstockOptions = {
    colors: ['#42B36F'], // Saturated blue from background gradient
    chart: {
        style: {
            fontFamily: 'Source Sans Pro',
        },
        spacingBottom: 18,
        spacingTop: -12,
        spacingLeft: 18,
        spacingRight: 18,
        borderRadius: 4,

        // height,
        // width,
    },
    rangeSelector: {
        // inputPosition: {
        //   y: 0,
        // },
        buttonPosition: {
            y: 25,
        },
        zIndex: 30,
        inputEnabled: false,
        // inputDateFormat: dayFullDateFormat,
        // inputEditDateFormat: dayFullDateFormat,
        buttons: [
            {
                type: 'hour',
                count: 6,
                text: '6h',
            },
            {
                type: 'hour',
                count: 24,
                text: '24h',
            },
            {
                type: 'day',
                count: 4,
                text: '4d',
            },
            {
                type: 'week',
                count: 1,
                text: '1w',
            },
            {
                type: 'month',
                count: 1,
                text: '1m',
            }, {
                type: 'all',
                text: 'All',
            }],
        selected: 2,
    },
    series: [{
        name: pairName,
        data: DataNew,
        type: 'areaspline',
        tooltip: {
            dateTimeLabelFormats,
            valueDecimals: 7,
            pointFormat: '{series.name}: <b>{point.y}</b><br />', // Remove the bullet point
        },
        fillColor: '#e3f7ff',
        zIndex: -1,
        lineWidth: 1,
        states: {
            hover: {
                enabled: false,
                // lineWidth: 2,
            },
        },
        threshold: null,
    }],
    tooltip: {
        backgroundColor: '#f4f4f5',
        borderColor: '#f4f4f5',
        borderRadius: 3,
        borderWidth: 0,
        crosshairs: [null, null],
        shadow: {
            // Same as the island stuff in StellarTerm
            color: 'rgba(0,0,0,0.375)', // 0.3/0.8=0.375 to account for tooltip opacity
            width: 3,
            offsetX: 0,
            offsetY: 1,
        },
        zIndex: 2,
        useHTML: true,
        style: {
            opacity: '0.8',
            cursor: 'default',
            fontSize: '12px',
            pointerEvents: 'none',
            whiteSpace: 'nowrap',
        },
    },
    xAxis: {
        dateTimeLabelFormats: axisDTLF,
        ordinal: false,
    },
    yAxis: {
        gridLineColor: 'rgba(0, 0, 0, 0.06)',
        gridZIndex: 30,
        tickPixelInterval: 30,
        minPadding: 0.1,
        maxPadding: 0.1,
        // minRange: setTimeout(()=>{
        //     DataNew[DataNew.length - 1][1]*0.5
        // }, 5000),
        labels: {
            formatter: function() {
                return this.value
            }
        }
    },
    navigator: {
        maskFill: 'rgba(66, 179, 111, 0.5)',
        series: {
            // type: 'areaspline',
            fillOpacity: 0.7,
            lineWidth: 1,
            lineColor: '#42B36F',
            fillColor: 'rgba(66, 179, 111, 0.5)',
            shadow: false,
        },
        outlineColor: '#42B36F',
        outlineWidth: 1,
    },
    scrollbar: {
        enabled: false,
    },
    credits: {
        enabled: false,
    },
};

const MyStockChart = ({ options, highcharts }) =>
        <HighchartsReact
            highcharts={Highcharts}
            constructorType={'stockChart'}
            options={highstockOptions}/>





export default MyStockChart

